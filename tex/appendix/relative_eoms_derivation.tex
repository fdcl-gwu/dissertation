% !TEX root = ../../dissertation.tex

\chapter{Derivation of Relative Equations of Motion}\label{proof:relative_dumbbell_eoms}
The Lagrangian function \( L \in \R \) is a scalar function of the generalized coordinates and their velocities.
The Lagrangian is defined as the total system kinetic energy minus the total system potential energy:
\begin{align*}
    L(q, \dot{q} ) = T(q, \dot{q}) - U (q) ,
\end{align*}
where \( T(q, \dot{q} \) is the kinetic energy of the system while \( U(q) \) is the potential energy of the system.
Similar to the derivation in~\cref{proof:inertial_dumbbell_eoms} we first find  the variation of the relative kinematic variables.
This is followed by the variation of the relative kinetic and potential energy and the application of Hamilton's principle.

The kinetic and potential energy of the dumbbell model is duplicated from~\cref{eq:relative_kinetic_energy,eq:relative_potential_energy}.
\begin{align*}
    T &= \frac{1}{2} \parenth{m_1 + m_2} \norm{\gls{sym:rvel}}^2 + \frac{1}{2} \tr{\hat{\gls{sym:rangvel}} J_{d_R} \hat{\glsentrytext{sym:rangvel}}^T},\\
    V &= -m_1 U( \gls{sym:rpos} + \gls{sym:ratt} \vc{\rho}_1) - m_2 U(\gls{sym:rpos} + \gls{sym:ratt} \vc{\rho}_2).
\end{align*}

\section{Relative variations}\label{sec:relative_variations}
In~\cref{proof:inertial_dumbbell_eoms} the variations of the inertial configuration variables were derived.
Following a similar process the variations of the reduced variables must be derived such that they also satisfy the variations of the inertial variables.
These variations must be defined precisely to ensure that the configuration space is preserved properly. 
These variations will be critical for the following step of applying the Euler-Lagrage equations and deriving the equations of motion.
The variations of the reduced variables are obtained from the variations of the original variables given in~\cref{eq:inertial_pos_variation,eq:inertial_vel_variation,eq:inertial_att_variation,eq:inertial_ang_vel_variation} and the definition of the reduced variables given in~\cref{eq:relative_position,eq:relative_velocity,eq:relative_attitude,eq:relative_angular_velocity}.

\subsection{Relative Position Variation}\label{sec:relative_position_variation}
The variation of the relative position given in~\cref{eq:relative_position} is defined as
\begin{align}
    \delta \gls{sym:rpos} &= \left. \diff{}{\epsilon} \right|_{\epsilon=0} \gls{sym:Ra}[^T] \gls{sym:ipos}^\epsilon ,\nonumber \\
                        &= \gls{sym:Ra}[^T] \delta \gls{sym:ipos} .\label{eq:relative_position_variation}
\end{align}

\subsection{Relative Attitude Variation}\label{sec:relative_attitude_variation}
The variation of the relative attitude given in~\cref{eq:relative_attitude} is expressed as
\begin{align}
    \delta \gls{sym:ratt} &= \left. \diff{}{\epsilon} \right|_{\epsilon=0}  \gls{sym:Ra}[^T] \gls{sym:iatt}^\epsilon = \gls{sym:Ra}[^T] \delta \gls{sym:iatt}, \nonumber\\
                          &= \gls{sym:Ra}[^T] \gls{sym:iatt} \gls{sym:iattvar} = \gls{sym:ratt} \gls{sym:iattvar}, \label{eq:relative_attitude_variation_1}
\end{align}
where we used the fact that the asteroid attitude does not vary, \( \delta \gls{sym:Ra} = 0\), and the variation of the spacecraft attitude is given in~\cref{eq:inertial_att_variation}.
The variation of the spacecraft attitude \( \gls{sym:iattvar} \in \so \) is related to the relative variation \( \gls{sym:rattvar} \in \so \) by
\begin{align}
    \gls{sym:rattvar} &= \gls{sym:ratt} \gls{sym:iattvar} \gls{sym:ratt}[^T],\nonumber\\
                      &= \gls{sym:Ra}[^T] \gls{sym:iatt} \gls{sym:iattvar} \gls{sym:iatt}[^T] \gls{sym:Ra}.\label{eq:relative_attitude_variation}
\end{align}
We can invert~\cref{eq:relative_attitude_variation} to find
\begin{align}\label{eq:relative_attitude_variation_inverse}
    \gls{sym:iattvar} &= \gls{sym:iatt}[^T] \gls{sym:Ra} \gls{sym:rattvar} \gls{sym:Ra}[^T] \gls{sym:iatt}.
\end{align}
Using this, the varation of the relative attitude is derived by substituting~\cref{eq:relative_attitude_variation_inverse} into~\cref{eq:relative_attitude_variation_1} as
\begin{align}\label{eq:relative_attitude_matrix_variation}
    \delta \gls{sym:ratt} = \gls{sym:Ra}[^T] \gls{sym:iatt} \gls{sym:iattvar} = \gls{sym:rattvar} \gls{sym:Ra}[^T] \gls{sym:iatt} = \gls{sym:rattvar} \gls{sym:ratt}
\end{align}

\subsection{Relative Angular Velocity Variation}\label{sec:relative_angular_velocity_variation}
The variation of the relative angular velocity is defined as follows:
\begin{align}\label{eq:relative_angular_velocity_variation_1}
    \parenth{\delta \gls{sym:rangvel}}^\wedge &= \left. \diff{}{\epsilon} \right|_{\epsilon=0} \parenth{ \gls{sym:ratt}[^\epsilon] \gls{sym:iangvel}[^\epsilon] }^\wedge, \nonumber\\
                                              &= \left. \diff{}{\epsilon} \right|_{\epsilon=0} \gls{sym:ratt}[^\epsilon] \hat{\glsentrytext{sym:iangvel}}^\epsilon \parenth{\gls{sym:ratt}[^\epsilon]}^T, \nonumber\\
                                              &= \delta \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \delta \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \hat{\gls{sym:iangvel}} \delta \gls{sym:ratt}[^T],
\end{align}
where we used~\cref{eq:hatRxR} to arrive at the final form.
The variation \( \delta \gls{sym:iangvel} \) is defined in~\cref{eq:inertial_ang_vel_variation} and subsitituded into~\cref{eq:relative_angular_velocity_variation_1} to give
\begin{align}\label{eq:relative_angular_velocity_variation_2}
    \parenth{\delta \gls{sym:rangvel}}^\wedge &= \delta \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \delta \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt}\hat{\gls{sym:iangvel}}\delta \gls{sym:ratt}[^T], \nonumber \\
                                              &= \gls{sym:rattvar} \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \parenth{ - \gls{sym:iattvar} \hat{\gls{sym:iangvel}} + \hat{\gls{sym:iangvel}}\gls{sym:iattvar} + \dot{\gls{sym:iattvar}} } \gls{sym:ratt}[^T] + \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] \gls{sym:rattvar}[^T], \nonumber \\
                                              &= \gls{sym:rattvar} \gls{sym:ratt}\hat{\gls{sym:iangvel}}\gls{sym:ratt}[^T] - \gls{sym:ratt} \gls{sym:iattvar} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:iattvar} \gls{sym:ratt}[^T] + \gls{sym:ratt} \dot{\gls{sym:iattvar}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] \gls{sym:iattvar}[^T].
\end{align}
Using the hat map identity given in~\cref{eq:hatRxR} in~\cref{eq:relative_angular_velocity_variation_2} gives
\begin{align}\label{eq:relative_angular_velocity_variation_3}
\parenth{\delta \gls{sym:rangvel}}^\wedge &= \gls{sym:rattvar} \parenth{ \gls{sym:ratt} \gls{sym:iangvel}}^\wedge - \gls{sym:ratt} \gls{sym:iattvar} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] + \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:iattvar} \gls{sym:ratt}[^T] + \gls{sym:ratt} \dot{\eta}_r \gls{sym:ratt}[^T] + \parenth{\gls{sym:ratt} \gls{sym:iangvel} }^\wedge \gls{sym:rattvar}[^T].
\end{align}
We can further simplify~\cref{eq:relative_angular_velocity_variation_3} by using the following identities which make use of~\cref{eq:relative_attitude_variation,eq:hatRxR}:
\begin{align}
    \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:iattvar} \gls{sym:ratt}[^T] &= \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] \gls{sym:ratt} \gls{sym:iattvar} \gls{sym:ratt}[^T] = \parenth{ \gls{sym:ratt} \gls{sym:iangvel}}^\wedge \parenth{ \gls{sym:ratt} \gls{sym:iattvar} \gls{sym:ratt}[^T]} = \parenth{\gls{sym:ratt}\gls{sym:iangvel}}^\wedge \gls{sym:rattvar}, \label{eq:RSeta_identity_1}\\
    -\gls{sym:ratt} \gls{sym:iattvar} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] &= -\gls{sym:ratt} \gls{sym:iattvar} \gls{sym:ratt}[^T] \gls{sym:ratt} \hat{\gls{sym:iangvel}} \gls{sym:ratt}[^T] = - \parenth{\gls{sym:ratt}\gls{sym:iattvar}\gls{sym:ratt}[^T]} \parenth{\gls{sym:ratt} \gls{sym:iangvel}}^\wedge = -\gls{sym:rattvar} \parenth{ \gls{sym:ratt} \gls{sym:iangvel}}^\wedge. \label{eq:RSeta_identity_2}
\end{align}
Substituting~\cref{eq:RSeta_identity_1,eq:RSeta_identity_2} into~\cref{eq:relative_angular_velocity_variation_3} gives
\begin{align}\label{eq:relative_angular_velocity_variation_4}
    \parenth{\delta \gls{sym:rangvel}}^\wedge &= \gls{sym:rattvar} \parenth{\gls{sym:ratt}\gls{sym:iangvel}}^\wedge - \gls{sym:rattvar} \parenth{\gls{sym:ratt}\gls{sym:iangvel}}^\wedge + \parenth{\gls{sym:ratt}\gls{sym:iangvel}}^\wedge + \gls{sym:ratt}\dot{\gls{sym:iattvar}}\gls{sym:ratt}[^T] + \parenth{\gls{sym:ratt}\gls{sym:iangvel}}^\wedge \gls{sym:rattvar}[^T] ,\nonumber \\
                                              &= \gls{sym:ratt} \dot{\gls{sym:iattvar}} \gls{sym:ratt}[^T] .
\end{align}
We now need to define \( \dot{\gls{sym:iattvar}}\) in terms of the reduced variables.
From~\cref{eq:relative_attitude} and the product rule we can define
\begin{align}\label{eq:relative_attitude_derivative_1}
    \dot{R}_r = \dot{R}_A^T R + R_A^T \dot{R}.
\end{align}
From the kinematic equation for the rotation matrix we have
\begin{subequations}\label{eq:attitude_kinematics_derivative}
\begin{align}
    \dot{R}_A &= R_A \hat{\Omega}_A, \\
    \dot{R} &= R \hat{\Omega} = R \parenth{\gls{sym:ratt}[^T]\gls{sym:rangvel}}^\wedge, 
\end{align}
\end{subequations}
where we used~\cref{eq:relative_angular_velocity}.
Applying~\cref{eq:attitude_kinematics_derivative,eq:hatRxR} into~\cref{eq:relative_attitude_derivative_1} gives
\begin{align}
    \dot{R}_r &= \hat{\Omega}_A^T R_A^T \gls{sym:iatt} + \gls{sym:Ra}[^T] \gls{sym:iatt} \parenth{\gls{sym:ratt}[^T] \gls{sym:rangvel}}^\wedge, \nonumber \\
              &= \hat{\Omega}_A^T R_A^T \gls{sym:iatt} + \gls{sym:Ra}[^T] \gls{sym:iatt} \gls{sym:ratt}[^T] \hat{\Omega}_r \gls{sym:ratt}, \nonumber \\
              &= - \hat{\Omega}_A \gls{sym:ratt} + \hat{\Omega}_r \gls{sym:ratt}. \label{eq:relative_attitude_derivative}
\end{align}
From~\cref{eq:relative_attitude_variation} and the product rule, the time derivative of \( \gls{sym:rattvar} \) is given by
\begin{align}\label{eq:relative_attitude_variation_derivative}
    \dot{\eta}_r = \dot{R}_r \gls{sym:iattvar} \gls{sym:ratt}[^T] + \gls{sym:ratt}\dot{\gls{sym:iattvar}}\gls{sym:ratt}[^T] + \gls{sym:ratt}\gls{sym:iattvar}\dot{R}_r^T 
\end{align}
Substituting~\cref{eq:relative_attitude_derivative} into~\cref{eq:relative_attitude_variation_derivative} gives
\begin{align}\label{eq:relative_attitude_variation_derivative_2}
    \dot{\eta}_r &= \braces{-\hat{\Omega}_A \gls{sym:ratt} + \hat{\Omega}_r \gls{sym:ratt}}\gls{sym:iattvar}\gls{sym:ratt}[^T] + \gls{sym:ratt}\dot{\gls{sym:iattvar}}\gls{sym:ratt}[^T] + \gls{sym:ratt}\gls{sym:iattvar}\braces{\gls{sym:ratt}[^T] \hat{\Omega}_A - \gls{sym:ratt}[^T] \hat{\Omega}_r}.
\end{align}
Inverting~\cref{eq:relative_attitude_variation_derivative_2} and solving for \( \gls{sym:ratt} \dot{\gls{sym:iattvar}} \gls{sym:ratt}[^T] \) gives
\begin{align}\label{eq:eta_dot}
    \gls{sym:ratt} \dot{\gls{sym:iattvar}} \gls{sym:ratt}[^T] &= \braces{\Omega_A - \hat{\Omega}_r} \gls{sym:rattvar} + \gls{sym:rattvar} \braces{\hat{\Omega}_r - \hat{\Omega}_A} + \dot{\eta}_r .
\end{align}
Finally, we can now substitute~\cref{eq:eta_dot} into~\cref{eq:relative_angular_velocity_variation_4} to arrive at
\begin{align}\label{eq:relative_angular_velocity_variation}
    \parenth{\delta \gls{sym:rangvel}}^\wedge &= \gls{sym:ratt} \dot{\gls{sym:iattvar}} \gls{sym:ratt}[^T] = \dot{\eta}_r - \hat{\Omega}_r \gls{sym:rattvar} + \hat{\Omega}_A \gls{sym:rattvar} +\gls{sym:rattvar} \hat{\Omega}_r - \gls{sym:rattvar} \hat{\Omega}_A, \nonumber \\
                                              &= \dot{\eta}_r + \gls{sym:rattvar}\braces{\hat{\Omega}_r - \hat{\Omega}_A} + \braces{\hat{\Omega}_A - \hat{\Omega}_r}\gls{sym:rattvar} . 
\end{align}

\subsection{Relative velocity variation}\label{sec:relative_velocity_variation}
The variation of the relative linear velocity is computed from~\cref{eq:relative_velocity} as
\begin{align}\label{eq:relative_velocity_variation_1}
    \delta \gls{sym:rvel} &= \left. \diff{}{\epsilon} \right|_{\epsilon=0} \gls{sym:Ra}[^T] \dot{x}^\epsilon , \nonumber \\
                          &= R_A^T \delta \dot{\gls{sym:ipos}},
\end{align}
since we assume that the asteroid is in a constant rate of rotation.
We can redefine~\cref{eq:relative_velocity_variation_1} in terms of the relative variables by finding the derivative of~\cref{eq:relative_position_variation} as
\begin{align}\label{eq:relative_position_variation_derivative_1}
    \delta \dot{x}_r &= \dot{R}_A^T \delta \gls{sym:ipos} + \gls{sym:Ra}[^T] \parenth{\delta \dot{\gls{sym:ipos}}}, \nonumber \\
                     &= \parenth{\gls{sym:Ra} \hat{\Omega}_A}^T \delta\gls{sym:ipos} + \gls{sym:Ra}[^T] \parenth{\delta \dot{\gls{sym:ipos}}}.
\end{align}
Rearranging~\cref{eq:relative_position_variation_derivative_1} for \(\delta \dot{\gls{sym:ipos}} \) and substituting into~\cref{eq:relative_velocity_variation_1} gives
\begin{align}\label{eq:relative_velocity_variation}
    \delta \gls{sym:rvel} = \delta \dot{x}_r + \hat{\Omega}_A \delta \gls{sym:rpos}.
\end{align}

In summary, the variation of the relative variables are defined as
\begin{align*}
    \delta \gls{sym:rpos} &= \gls{sym:Ra}[^T] \delta \gls{sym:ipos}, \\
    \delta \gls{sym:ratt} &= \gls{sym:rattvar} \gls{sym:ratt} ,\\
    \parenth{\delta \gls{sym:rangvel}}^\wedge&= \dot{\eta}_r - \hat{\Omega}_r \gls{sym:rattvar} + \hat{\Omega}_A \gls{sym:rattvar} + \gls{sym:rattvar} \hat{\Omega}_R - \gls{sym:rattvar} \hat{\Omega}_A, \\
    \delta \gls{sym:rvel} &= \dot{x}_r + \hat{\Omega}_A \delta \gls{sym:rpos} .
\end{align*}

\section{Variation of the Relative Kinetic Energy}\label{sec:relative_kinetic_energy_variation}
The variation of the kinetic energy follows a similar process as that shown in~\cref{sec:inertial_kinetic_energy_variation}.
The variation of the reduced kinetic energy, shown in~\cref{eq:relative_kinetic_energy}, is given by
\begin{align}\label{eq:relative_kinetic_energy_variation_1}
    \delta T &= \left. \diff{}{\epsilon} \right|_{\epsilon=0} T(\gls{sym:rvel} + \epsilon \delta \gls{sym:rvel}, \gls{sym:rangvel} + \epsilon \delta \gls{sym:rangvel}) , \nonumber \\
             &= (m_1 + m_2) \gls{sym:rvel}[^T] \delta \gls{sym:rvel} + \frac{1}{2} \tr{ \parenth{\delta \gls{sym:rangvel}}^\wedge J_{d_{R}} \hat{\Omega}_r^T   + \hat{\Omega}_r J_{d_{R}} \parenth{\delta \gls{sym:rangvel}}^{\wedge T}},
\end{align}
where we substituted~\cref{eq:relative_velocity_variation}.
Now, we can substitute~\cref{eq:relative_angular_velocity} into the second term of~\cref{eq:relative_kinetic_energy_variation_1} to get
\begin{align}\label{eq:relative_kinetic_energy_b_1}
    \frac{1}{2} \mathrm{tr} & \left[ \braces{\dot{\eta}_r \gls{sym:Jdr} \hat{\Omega}_r^T - \hat{\Omega}_r \gls{sym:rattvar} \gls{sym:Jdr} \hat{\Omega}_r^T + \hat{\Omega}_A \gls{sym:rattvar} \gls{sym:Jdr} \hat{\Omega}_r^T + \gls{sym:rattvar} \hat{\Omega}_r \gls{sym:Jdr} \hat{\Omega}_r^T - \gls{sym:rattvar} \hat{\Omega}_A \gls{sym:Jdr} \hat{\Omega}_r^T } \right. \\
                            & \left. \braces{ -\hat{\Omega}_r \gls{sym:Jdr} \dot{\eta}_r - \hat{\Omega}_r \gls{sym:Jdr} \gls{sym:rattvar} \hat{\Omega}_r + \hat{\Omega}_r \gls{sym:Jdr} \gls{sym:rattvar} \hat{\Omega}_A + \hat{\Omega}_r \gls{sym:Jdr} \hat{\Omega}_r \gls{sym:rattvar} - \hat{\Omega}_r \gls{sym:Jdr} \hat{\Omega}_A \gls{sym:rattvar} }\right]
\end{align}
The terms containing \( \dot{\eta}_r \) in~\cref{eq:relative_kinetic_energy_b_1} can be redefined as
\begin{subequations}\label{eq:relative_eta_dot_substitution}
\begin{align}
    \tr{ \dot{\eta}_r \gls{sym:Jdr} \hat{\Omega}_r^T} &= \tr{ - \dot{\eta}_r \gls{sym:Jdr} \hat{\Omega}_r^T},  \\
    \tr{-\hat{\Omega}_r \gls{sym:Jdr} \dot{\eta}_r} &= \tr{ -\dot{\eta}_r \hat{\Omega}_r \gls{sym:Jdr}},
\end{align}
\end{subequations}
where we used~\cref{eq:trABC,eq:hatxT}.

Expanding~\cref{eq:relative_kinetic_energy_b_1} after substituting~\cref{eq:relative_eta_dot_substitution} and collecting terms gives
\begin{align}\label{eq:relative_kinetic_energy_b_2}
    \frac{1}{2} \tr{ -\dot{\hat{\eta}}\parenth{ \gls{sym:Jdr} \hat{\Omega}_r - \hat{\Omega}_r \gls{sym:Jdr} } + A + B },
\end{align}
where
\begin{subequations}\label{eq:relative_kinetic_energy_A_and_B}
\begin{align}
    A &= - \hat{\Omega}_r \gls{sym:rattvar} \gls{sym:Jdr} \hat{\Omega}_r^T + \gls{sym:rattvar} \hat{\Omega}_r \gls{sym:Jdr} \hat{\Omega}_r^T - \hat{\Omega}_r \gls{sym:Jdr} \gls{sym:rattvar} \hat{\Omega}_r + \hat{\Omega}_r \gls{sym:Jdr} \hat{\Omega}_r \gls{sym:rattvar},\label{eq:relative_kinetic_energy_A_1}\\ 
    B &= \hat{\Omega}_A \gls{sym:rattvar} \gls{sym:Jdr} \hat{\Omega}_r^T - \gls{sym:rattvar} \hat{\Omega}_A \gls{sym:Jdr} \hat{\Omega}_r^T  + \hat{\Omega}_r \gls{sym:Jdr} \gls{sym:rattvar} \hat{\Omega}_A - \hat{\Omega}_r \gls{sym:Jdr} \hat{\Omega}_A \gls{sym:rattvar}.\label{eq:relative_kinetic_energy_B_1}
\end{align}
\end{subequations}     
From the properties of the trace we can show that~\cref{eq:relative_kinetic_energy_A_1} goes to zero.
Consider~\cref{eq:relative_kinetic_energy_B_1}, we utilize the following substitutions
\begin{subequations}\label{eq:relative_kinetic_energy_B_simplification}
\begin{align}
    \tr{ - \gls{sym:rattvar} \hat{\Omega}_A \gls{sym:Jdr}  \hat{\Omega}_r^T} &= \tr{\gls{sym:rattvar}  \hat{\Omega}_A \gls{sym:Jdr}  \hat{\Omega}_r} , \\
    \tr{ \hat{\Omega}_r \gls{sym:Jdr} \gls{sym:rattvar}  \hat{\Omega}_A} &= \tr{ \gls{sym:rattvar}  \hat{\Omega}_A  \hat{\Omega}_r \gls{sym:Jdr}} , \\
    \tr{  \hat{\Omega}_A \gls{sym:rattvar} \gls{sym:Jdr}  \hat{\Omega}_r^T} &= \tr{ - \gls{sym:rattvar} \gls{sym:Jdr}  \hat{\Omega}_r  \hat{\Omega}_A    } , \\
    \tr{-  \hat{\Omega}_r \gls{sym:Jdr}  \hat{\Omega}_A \gls{sym:rattvar}    } &= \tr{ - \gls{sym:rattvar}  \hat{\Omega}_r \gls{sym:Jdr}  \hat{\Omega}_A    } .
\end{align}
\end{subequations}     

Substituting~\cref{eq:relative_kinetic_energy_B_simplification} into~\cref{eq:relative_kinetic_energy_B_1} gives:
\begin{align}
    B &= \frac{1}{2} \tr{\gls{sym:rattvar} \hat{\Omega}_A\parenth{\gls{sym:Jdr} \hat{\Omega}_r+ \hat{\Omega}_r\gls{sym:Jdr}} - \gls{sym:rattvar}\parenth{\gls{sym:Jdr} \hat{\Omega}_r+ \hat{\Omega}_r\gls{sym:Jdr}}  \hat{\Omega}_A}. \label{eq:relative_kinetic_energy_B_2}
\end{align}
Using~\cref{eq:moi_relative_hat_prop,eq:hatxy} leads to the following simplifications of~\cref{eq:relative_kinetic_energy_B_2} as follows:
\begin{align}
    B &= \frac{1}{2} \tr{\gls{sym:rattvar}\parenth{ \hat{\Omega}_A\parenth{\gls{sym:Jr}  \hat{\Omega}_r}}^\wedge}. \label{eq:relative_kinetic_energy_B_final}
\end{align}
Finally, substituting~\cref{eq:relative_kinetic_energy_B_final} into~\cref{eq:relative_kinetic_energy_b_2} and then into~\cref{eq:relative_kinetic_energy_variation_1} along with using~\cref{eq:moi_relative_hat_prop} gives the final variation of the relative kinetic energy as
\begin{align}\label{eq:relative_kinetic_energy_variation}
    \delta T =& (m_1 + m_2) \gls{sym:rvel}[^T] \parenth{\delta \dot{x}_r +  \hat{\Omega}_A \delta \gls{sym:rpos}} + \frac{1}{2} \tr{ -\dot{\hat{\eta}}\parenth{\gls{sym:Jr}  \hat{\Omega}_r }} \\
             &+\frac{1}{2} \tr{\gls{sym:rattvar}\parenth{ \hat{\Omega}_A\parenth{\gls{sym:Jr}  \hat{\Omega}_r}}^\wedge} .
\end{align}


\section{Variation of the Relative Potential Energy}\label{sec:relative_potential_energy}
The variation of the relative potential energy is found defined by finding the variation of~\cref{eq:relative_potential_energy} as
\begin{align}\label{eq:relative_potential_energy_variation_1}
    \delta V &= \left. \diff{}{\epsilon} \right|_{\epsilon=0} V(\gls{sym:rpos} + \epsilon \delta \gls{sym:rpos}, \gls{sym:ratt} + \epsilon \delta \gls{sym:ratt}).
\end{align}
Substituting the variations given by~\cref{eq:relative_position_variation,eq:relative_attitude_variation} gives the variation of the potential energy
\begin{align}\label{eq:relative_potential_energy_variation}
    \delta V &= -m_1 \deriv{U}{z_1}^T \delta \gls{sym:rpos} - m_1 \deriv{U}{z_2}^T \delta \gls{sym:rpos} - m_1 \tr{ \gls{sym:rattvar} \gls{sym:ratt} \rho_1 \deriv{U}{z_1}^T} - m_2 \tr{\gls{sym:rattvar} \gls{sym:ratt} \rho_2 \deriv{U}{z_2}^T}.
\end{align}

\section{Hamilton's Principle}\label{sec:relative_hamiltons_principle}

Given the reduced variations of the kinetic and potential energies given in~\cref{eq:relative_kinetic_energy_variation,eq:relative_potential_energy_variation} the variation of the reduced Lagrangian is given by
\begin{align}\label{eq:relative_lagrangian_variation}
    \delta L =& (m_1 + m_2) \gls{sym:rvel}[^T] \parenth{\delta \dot{x}_r +  \hat{\Omega}_A \delta \gls{sym:rpos}} + \frac{1}{2} \tr{ -\dot{\hat{\eta}}\parenth{\gls{sym:Jr}  \hat{\Omega}_r }} \nonumber\\
    &+\frac{1}{2} \tr{\gls{sym:rattvar}\parenth{ \hat{\Omega}_A\parenth{\gls{sym:Jr}  \hat{\Omega}_r}}^\wedge} -m_1 \deriv{U}{z_1}^T \delta \gls{sym:rpos} - m_1 \deriv{U}{z_2}^T \delta \gls{sym:rpos} \nonumber\\
    &- m_1 \tr{ \gls{sym:rattvar} \gls{sym:ratt} \rho_1 \deriv{U}{z_1}^T} - m_2 \tr{\gls{sym:rattvar} \gls{sym:ratt} \rho_2 \deriv{U}{z_2}^T}.
\end{align}
Hamilton's principle states that the variation of the action integral is zero for all possible variations, in other words the following
\begin{align}\label{eq:relative_hamiltons_principle_1}
    \delta \mathcal{G} =& \int_{t_0}^{t_f} \left\{\parenth{m_1+m_2} \gls{sym:rvel}[^T] \delta \dot{x}_r + \parenth{m_1 + m_2} \gls{sym:rvel}[^T] \hat{\Omega}_A \delta \gls{sym:rpos}\right. \nonumber\\
                        & \left.+ m_1 \deriv{U}{z_1}^T \delta \gls{sym:rpos} + m_2 \deriv{U}{z_2}^T \delta \gls{sym:rpos} \right\} dt \nonumber\\
                        & +\int_{t_0}^{t_f} \left\{ \frac{1}{2} \tr{-\dot{\eta}_r \parenth{\gls{sym:Jr} \gls{sym:rangvel}}^\wedge }  + \frac{1}{2} \tr{\gls{sym:rattvar} \parenth{\hat{\Omega}_A \parenth{\gls{sym:Jr}\gls{sym:rangvel}}}^\wedge}\right. \nonumber\\
                        & \left.+ m_1 \tr{\gls{sym:rattvar}\gls{sym:ratt}\rho_1\deriv{U}{z_1}^T} + m_2 \tr{\gls{sym:rattvar}\gls{sym:ratt}\rho_2\deriv{U}{z_2}^T}\right\} dt = 0,
\end{align}
for all \( \delta \gls{sym:rpos} : \bracket{t_0, t_f} \to \R^3 \) and \( \gls{sym:rattvar} : \bracket{t_0, t_f} \to \so \) with stationary end points.
Using integration by parts, and noting that the variations at the end point are stationary gives
\begin{align}\label{eq:relative_hamiltons_principle}
    \delta \mathcal{G} =& \int_{t_0}^{t_f} \left\{-\parenth{m_1+m_2} \dot{v}_r^T + \parenth{m_1 + m_2} \gls{sym:rvel}[^T] \hat{\Omega}_A + m_1 \deriv{U}{z_1}^T + m_2 \deriv{U}{z_2}^T \right\}\delta \dot{x}_r  dt \nonumber\\
                        & +\int_{t_0}^{t_f} \frac{1}{2} \tr{\dot{\eta}_r \braces{\dot{\widehat{\parenth{\gls{sym:Jr} \gls{sym:rangvel}}}} + \parenth{\hat{\Omega}_A \parenth{\gls{sym:Jr}\gls{sym:rangvel}}}^\wedge }} dt \\
                        & + \int_{t_0}^{t_f}  \frac{1}{2} \tr{\gls{sym:rattvar} \braces{2 m_1\gls{sym:ratt}\rho_1\deriv{U}{z_1}^T + 2 m_2 \gls{sym:ratt}\rho_2\deriv{U}{z_2}^T}} dt.
\end{align}
In order for~\cref{eq:relative_hamiltons_principle} to be stationary for all possible variations, the expression in the first brace should be zero and the expressions in the last two braces should be symmetric since \( \gls{sym:rattvar} \in \so \) is skew-symmetric.
As a result, the translational equations of relative motion are 
\begin{align}
    \parenth{m_1 + m_2} \dot{v}_r + \parenth{m_1 + m_2} \hat{\Omega}_A \gls{sym:rvel} + m_1 \deriv{U}{z_1} + m_2 \deriv{U}{z_2} = 0.
\end{align}
The rotational equations of motion are found by applying~\cref{eq:trPQ} to find
\begin{align}
    - \dot{\widehat{\parenth{\gls{sym:Jr} \gls{sym:rangvel}}}} &- \parenth{\hat{\Omega}_A \parenth{\gls{sym:Jr} \gls{sym:rangvel}}}^\wedge + m_1 \deriv{U}{z_1} \rho_1^T \gls{sym:ratt}[^T] - m_1 \gls{sym:ratt}\rho_1\deriv{U}{z_1}^T \nonumber \\
    &+ m_2 \deriv{U}{z_2} \rho_2^T \gls{sym:ratt}[^T] - m_2 \gls{sym:ratt} \deriv{U}{z_2}^T = 0
\end{align}
Using the property~\cref{eq:hatxy} gives
\begin{align}
    \dot{\gls{sym:Jr} \gls{sym:rangvel}} + \hat{\Omega}_A \parenth{\gls{sym:Jr} \gls{sym:rangvel}} = m_1 \parenth{\gls{sym:ratt} \rho_1}^\wedge \deriv{U}{z_1} + m_2 \parenth{\gls{sym:ratt} \rho_2}^\wedge \deriv{U}{z_2}.
\end{align}
In summary, the equation of relative motion of a dumbbell spacecraft, in Lagrangian form, are
\begin{align}
    \dot{x}_r &= \gls{sym:rvel} - \hat{\Omega}_A \gls{sym:rpos}, \\
    \parenth{m_1 + m_2} \dot{v}_r  &= -\parenth{m_1 + m_2} \hat{\Omega}_A \gls{sym:rvel} + m_1 \deriv{U}{z_1} + m_2 \deriv{U}{z_2}, \\
    \dot{R}_r &= \hat{\Omega}_r \gls{sym:ratt} - \hat{\Omega}_A \gls{sym:ratt}, \\
    \dot{\gls{sym:Jr} \gls{sym:rangvel}} + \hat{\Omega}_A \parenth{\gls{sym:Jr} \gls{sym:rangvel}} &= m_1 \parenth{\gls{sym:ratt} \rho_1}^\wedge \deriv{U}{z_1} + m_2 \parenth{\gls{sym:ratt} \rho_2}^\wedge \deriv{U}{z_2}.
\end{align}
